<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý người dùng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-success px-4">
    <a class="navbar-brand" href="index.html">Trang chủ</a>
    <ul class="navbar-nav ms-auto d-flex flex-row gap-3">
      <li class="nav-item"><a class="nav-link text-white fw-bold" href="users.html">Quản lý người dùng</a></li>
      <li class="nav-item"><a class="nav-link text-white" href="#" onclick="logout()">Đăng xuất</a></li>
    </ul>
  </nav>

  <div class="container mt-4">
    <h3 class="mb-4">Danh sách người dùng</h3>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Tên đăng nhập</th>
          <th>Email</th>
          <th>Hành động</th>
          <th>Thao tác</th>
        </tr>
      </thead>
      <tbody id="userTableBody"></tbody>
    </table>
  </div>

  <script>
  const role = localStorage.getItem('role');
  if (role !== 'admin') {
    alert('Bạn không có quyền truy cập trang này!');
    window.location.href = 'index.html';
  }
  
    const body = document.getElementById('userTableBody');
      let users = [];

  function renderUsers() {
    const userTable = document.getElementById('userTableBody');
    userTable.innerHTML = '';

    users.forEach(u => {
      userTable.innerHTML += `
        <tr>
          <td>${u.username}</td>
          <td>${u.email}</td>
          <td>${u.role}</td>
          <td><button onclick="deleteUser('${u.username}')">Xoá</button></td>
        </tr>
      `;
    });
  }

  function deleteUser(username) {
    if (!confirm(`Xoá người dùng ${username}?`)) return;
    fetch(`http://localhost:3000/api/users/${username}`, {
      method: 'DELETE'
    })
    .then(res => {
      if (!res.ok) throw new Error('Xoá thất bại');
      users = users.filter(u => u.username !== username);
      renderUsers();
    })
    .catch(err => alert(err.message));
  }

  window.onload = function () {
    fetch('http://localhost:3000/api/users')
      .then(res => res.json())
      .then(data => {
        users = data;
        renderUsers();
      })
      .catch(err => {
        console.error('Lỗi tải danh sách người dùng:', err);
      });
  };
  </script>
</body>
</html>
